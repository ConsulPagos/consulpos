<h1 mat-dialog-title class="mat-dialog-title">
    <div class="text-center">
        <div>
            <li class="fa fa-truck mr-2"></li> Confirme su pedido
        </div>
    </div>
</h1>

<div mat-dialog-content class="mat-dialog-content" *ngIf="!loadingStatus; else loadingTmp">
    <div class="less-padding">
        <div class="d-flex">
            <h6 class="flex-fill">Total</h6>
            <strong>{{data.pedido.total | currency : 'USD' : true : '1.2-2'}}</strong>
        </div>
        <mat-divider class="mb-2"></mat-divider>
        <div class="d-flex" *ngFor="let order of data.orders">
            <div class="flex-fill d-flex justify-content-left align-items-center">
                {{order.product.producto}}
            </div>
            <div class="d-flex justify-content-left align-items-center mr-4" style="min-width: 100px;">
                {{order.units}} x {{order.format.descripcion}}
            </div>
            <div class="d-flex justify-content-right align-items-center" style="min-width: 60px;">
                <span class="ml-auto">
                    {{(order.units*order.format.precio - order.units*order.format.precio*(order.descuento/100)) | currency : 'USD' : true : '1.2-2'}}
                </span>
            </div>
        </div>
    </div>
    <div class="less-padding">
        <h6 class="mb-1 mt-3">Dirección</h6>
        <mat-divider class="mb-1"></mat-divider>
        <p>{{data.address}}</p>
    </div>
    <div class="less-padding">
        <h6 class="mb-1 mt-3">Programar entrega</h6>
        <input class="form-control shadow-none" type="datetime-local"
            (input)="data.pedido.programar_entrega = $event.target.value" min={{startDateStr}}>
    </div>
    <div class="mt-3 less-padding info-credit d-flex" *ngIf="status.has_credit">
        <span class="alert alert-altius text-dark w-100" role="alert">  <i class="fas fa-credit-card mr-2"></i> Tienes un plazo de {{status.credit}} días para pagar el
            pedido </span>
    </div>
    <div class="less-padding" *ngIf="!status.has_credit">
        <h6 class="mb-1 mt-3">Medio de pago</h6>
        <form [formGroup]="form" *ngIf="!loadingMethods; else loadingMethodsTmp">
            <select formControlName="medio_pago" id="method" class="form-control shadow-none">
                <option selected class="text-uppercase" value="">Seleccionar medio de pago</option>
                <option value={{method.id_medio_pago}} *ngFor="let method of methods">{{method.medio_pago}}</option>
            </select>
        </form>
        <div *ngIf="form.get('medio_pago').errors" class="text-danger small">
            <div *ngIf="form.get('medio_pago').errors.required">
                Medio de Pago <strong>requerido</strong>
            </div>
        </div>
    </div>
</div>
<div mat-dialog-actions class="mat-dialog-actions" *ngIf="!loadingStatus">
    <div class="d-flex w-100 btn-container" *ngIf="!loading; else loadingSpinner">
        <button class="flex-fill cancel action_button" mat-button mat-dialog-close>
            <li class="fa fa-times text-dark"></li>
        </button>
        <button class="flex-fill confirm action_button" mat-button cdkFocusInitial (click)="onSubmit()">
            <li class="fa fa-check"></li>
        </button>
    </div>
</div>

<ng-template #loadingSpinner>
    <div class="d-flex justify-content-center align-items-center w-100">
        <mat-spinner [diameter]="30"></mat-spinner>
    </div>
</ng-template>

<ng-template #loadingTmp>
    <div class="d-flex justify-content-center align-items-center w-100" style="min-height: 150px;">
        <div *ngIf="!errorStatus">
            <mat-spinner [diameter]="30"></mat-spinner>
        </div>
        <button mat-button *ngIf="errorStatus" (click)="loadStatus()"> <i class="fas fa-redo-alt"></i>
            Reintentar</button>
    </div>
</ng-template>

<ng-template #loadingMethodsTmp>
    <div *ngIf="!errorMethods" class="loading d-flex justify-content-left align-items-center btn shadow-none">
        Cargando
    </div>
    <button class="loading d-flex justify-content-left align-items-center btn shadow-none" *ngIf="errorMethods"
        (click)="loadMethods()">Pulse para cargar</button>
</ng-template>